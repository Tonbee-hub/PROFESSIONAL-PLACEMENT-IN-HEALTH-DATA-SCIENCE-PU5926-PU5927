---
output: html_document
runtime: shiny
---
in---
title: "Placement project_1308"
author: "TONBARA DONALD IBIBO (52426639)"
date: "2025-08-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries 

```{r message=FALSE, warning=FALSE, include=FALSE}

packages <- c("shiny", "readxl", "stringr", "DT", "packrat", "renv", "snowflakeauth", "rsconnect",  "ggplot2", "dplyr", "PKI")
installed <- packages %in% rownames(installed.packages())
if (any(!installed)) {
  install.packages(packages[!installed])
}
lapply(packages, library, character.only = TRUE)

```

## Load data

```{r}
data <- read_excel("CANCER CARD NUTRITION SUPPORT SURVEY.xlsx", sheet = "data")

```

## Clean data

```{r}

# Rename and transform columns
data_clean <- data %>%
  rename(
    CancerRelationship = `Cancer Relationship`,
    NutritionSearchTopic = `Have you searched for nutrition-related information on the Cancer Card website + Nutrition Topics?`,
    InfoFound = `found the nutrition information you require`,
    Format = `Nutrition support access format`,
    Confidence = `Confidence Level`,
    Comments = `Additional Comments`
  ) %>%
  mutate(
    Searched = ifelse(str_detect(NutritionSearchTopic, "^Yes"), "Yes", "No"),
    Confidence = as.numeric(Confidence),
    CancerRelationship = factor(CancerRelationship),
    Format = factor(Format),
    InfoFound = factor(InfoFound),
    Searched = factor(Searched)
  )

```

## Define UI (User Interface)

```{r}

ui <- navbarPage("Cancer Card Nutritional Insights",

  # TAB 1: Dashboard view
  tabPanel("Dashboard",
    sidebarLayout(
      sidebarPanel(
        selectInput("cancerRel", "Select Cancer Relationship(s):",
                    choices = levels(data_clean$CancerRelationship),
                    selected = levels(data_clean$CancerRelationship)[1],
                    multiple = TRUE)
      ),
      mainPanel(
        plotOutput("confidencePlot", height = "300px"),
        plotOutput("formatPlot", height = "300px"),
        h4("Sample User Comments:"),
        verbatimTextOutput("sampleComments")
      )
    )
  ),

  # TAB 2: Full Raw Data
  tabPanel("Raw Data",
    h4("View Filtered Survey Data"),
    DTOutput("rawTable")
  ),

  # TAB 3: Summary
  tabPanel("Summary",
    h4("Summary Statistics for Filtered Data"),
    verbatimTextOutput("summaryStats")
  )
)

```

## Define Server Logic

```{r}

server <- function(input, output) {

  # Reactive dataset based on selected cancer relationship(s)
  filtered_data <- reactive({
    req(input$cancerRel)  # Ensure input exists
    data_clean %>% filter(CancerRelationship %in% input$cancerRel)
  })

  # Bar Chart: Confidence in managing nutrition
  output$confidencePlot <- renderPlot({
    ggplot(filtered_data(), aes(x = factor(Confidence))) +
      geom_bar(fill = "#2c7fb8") +
      labs(title = "Confidence in Managing Nutrition",
           x = "Confidence Level (1 = low, 5 = high)",
           y = "Number of Respondents") +
      theme_minimal(base_size = 13)
  })

  # Pie Chart: Preferred support formats
  output$formatPlot <- renderPlot({
    df <- filtered_data() %>%
      group_by(Format) %>%
      summarise(Count = n(), .groups = "drop")

    ggplot(df, aes(x = "", y = Count, fill = Format)) +
      geom_col() +
      coord_polar(theta = "y") +
      theme_void() +
      labs(title = "Preferred Nutrition Support Format") +
      theme(legend.position = "right")
  })

  # Display 1â€“3 random comments
  output$sampleComments <- renderPrint({
    comments <- filtered_data()$Comments
    comments <- comments[!is.na(comments)]
    if (length(comments) >= 3) {
      sample(comments, 3)
    } else if (length(comments) > 0) {
      sample(comments, 1)
    } else {
      "No comments available for the selected filter."
    }
  })

  # Interactive raw data table
  output$rawTable <- renderDT({
    datatable(filtered_data(), options = list(pageLength = 10, scrollX = TRUE))
  })

  # Summary statistics for numeric and factor fields
  output$summaryStats <- renderPrint({
    summary(filtered_data())
  })
}

```

## Run the App

```{r}

shinyApp(ui = ui, server = server)

```


